# Implementation Plan: Size Reporting Dashboard

**Branch**: `003-add-size-reports` | **Date**: 2025-11-05 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-add-size-reports/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/scripts/bash/setup-plan.sh` for the execution workflow.

## Summary

Deliver repository-hosted size reporting tooling that (1) captures reproducible HEAD vs. MASTER CSV snapshots per sandbox variant via a Python-based `reports/size/update` CLI while recording commit SHAs and messages, (2) provides an HTML dashboard using Chart.js to visualize folder selections, and (3) integrates with CI/update workflows while honoring binary and memory budgets outlined in the spec.

## Technical Context

<!--
  ACTION REQUIRED: Replace the content in this section with the technical details
  for the project. The structure here is presented in advisory capacity to guide
  the iteration process.
-->

**Language/Version**: Repository tooling implemented in Python 3 (standard repo/runtime); engine runtime remains C23 (clang-cl / emcc).  
**Primary Dependencies**: Git CLI for commit resolution, Python standard library for `os.stat` sizing and CSV writing, Chart.js (bundled minified script under `reports/size/lib/`) for browser visualization.  
**Storage**: CSV files under `reports/size/<testbed>/<platform>/<configuration>/report.txt`; HTML dashboard at `reports/size/report.html`. No runtime persistent storage.  
**Testing**: Command-line smoke script for report generation, automated check that CSV schema matches spec, browser-based HTML verification (Playwright-lite checklist).  
**Target Platform**: Tooling runs on developer machines and Linux CI agents; Windows developers supported via Python portability. HTML dashboard targets evergreen desktop browsers.  
**Project Type**: Repository tooling plus static assets; engine binaries unaffected but plan must ensure no runtime integration leaks.  
**Performance Goals**: Update workflow completes <10s for ≤25 artifacts; dashboard loads data and renders graphs <2s per folder.  
**Constraints**: `.wasm` ≤ 200 KB and per-feature code ≤30 KB unaffected; ensure CSV/HTML assets remain ≤30 KB per folder; no new runtime allocations.  
**Scale/Scope**: Touch `reports/size` directory, add helper script(s), optional documentation updates, CI pipeline hook addition.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- [x] **Binary Budget Supremacy**: No compiled binary impact; dashboard assets (including Chart.js bundle) live outside shipped binaries and are monitored via the size-report CI step.
- [x] **Deterministic Memory Discipline**: Tooling operates outside runtime; no new `nt_alloc_*` usage introduced, preserving deterministic memory model.
- [x] **Performance-Oriented Portability**: Plan tracks workflow runtime (<10s) and dashboard load (<2s) across CI and developer environments, with validation steps in quickstart.
- [x] **Spec-Led Delivery**: Approved spec exists and defines C API surface (none), memory model, binary impact, and embedding considerations; this plan links directly.
- [x] **Embedded Feature Isolation**: Work limited to repository tooling and reports directory; engine module isolation preserved with no new runtime headers/sources.

_Post-Phase 1 Re-evaluation (2025-11-05): All constitutional gates remain satisfied; decisions in research/design uphold budget, memory, performance, and isolation commitments._

## Project Structure

### Documentation (this feature)

```text
specs/003-add-size-reports/
├── plan.md              # Implementation plan (this file)
├── research.md          # Phase 0 findings
├── data-model.md        # Structured entities and validations
├── quickstart.md        # Execution guide for tooling + dashboard
├── contracts/           # API/data contract outputs
└── tasks.md             # Generated by /speckit.tasks (Phase 2, future)
```

### Source & Asset Layout (repository)

```text
reports/
└── size/
    ├── report.html            # Dashboard entry point
    ├── lib/
    │   └── chart.min.js       # Bundled Chart.js library
    ├── update (script)        # CLI workflow to refresh HEAD snapshots
    ├── sandbox/
    │   └── wasm/
    │       ├── debug/
    │       │   └── report.txt # CSV snapshot
    │       └── release/
    │           └── report.txt
    └── README.md              # Baseline management guidance

ci/
└── workflows/
    └── size-report.yml        # CI hook invoking update workflow (existing file updated or new)

.specify/
└── scripts/
    └── bash/
        └── size-report-check.sh (optional helper if CI needs wrapper)
```

**Structure Decision**: Work is confined to `reports/size` for tooling and documentation plus any CI workflow updates; engine feature modules remain untouched, maintaining paired header/source integrity and embedded delivery model.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
